<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Connexion en cours...</title>
</head>
<body style="color:white; background:#0f0f0f; text-align:center; padding-top:50px;">
  <h1>Connexion à Discord...</h1>
  <script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");

    if (!code) {
      alert("Erreur de connexion à Discord.");
      window.location.href = "/";
    }

    fetch("https://discord.com/api/oauth2/token", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({
        client_id: "1373603167555686510",
        client_secret: "À REMPLACER_PAR_TON_CLIENT_SECRET",
        grant_type: "authorization_code",
        code: code,
        redirect_uri: "https://michael75013.github.io/concessionnaire/callback.html"
      })
    })
    .then(res => res.json())
    .then(token => {
      return fetch("https://discord.com/api/users/@me", {
        headers: {
          Authorization: `${token.token_type} ${token.access_token}`
        }
      });
    })
    .then(res => res.json())
    .then(user => {
      localStorage.setItem("discordUserId", user.id);
      window.location.href = "https://michael75013.github.io/concessionnaire/";
    })
    .catch(err => {
      console.error(err);
      alert("Échec de la connexion.");
    });
  </script>
</body>
</html>
